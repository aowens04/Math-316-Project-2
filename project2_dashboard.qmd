---
title: "Marketing Data"
author: "Paige Hill, Lauren McIntosh, Amaya Owens"
format:
  dashboard:
    theme: flatly
    orientation: rows
    embed-resources: true
jupyter:
  kernelspec:
    name: python3
    display_name: Python 3
    language: python
---

```{python}
#| label: info
#| include: false

import pandas as pd
import altair as alt
import numpy as np
from great_tables import GT
import matplotlib.pyplot as plt
alt.renderers.enable('html')

#initializing dataframe
df = pd.read_csv("bank-full.csv", sep=";")

#sample dataframe
df_sample = df.sample(5000, random_state=516)

```
# Demographics and Finances
## Row {height="60px"}
<div style="font-size: 15pt">What are the demographic and financial profiles of clients who subscribe to a term deposit compared to those who do not?</div>

## Row


# Strategy

## Row {height="60px"}
<div style="font-size: 15pt">How does the strategy of the campaign correlate with success rate of subscriptions?</div>

## Row 
```{python}
day_bins = [0,7,14,21,30]
day_labels=["1-7","8-14","15-21","22-30"]
binned_days = pd.cut(df['day'], bins=day_bins, labels=day_labels)

days_crosstab = pd.crosstab(binned_days, df['y'])
days_crosstab['percent'] = days_crosstab['yes']/(days_crosstab['no']+days_crosstab['yes'])
days_crosstab['days'] = days_crosstab.index
reordered_days = days_crosstab[['days','yes','no','percent']]

pretty_days = (GT(reordered_days)
    .tab_header(title="Days of Contact")
    .fmt_number(columns='percent', decimals=2)
    .data_color(
        palette="Blues",
        domain=[0.11, 1],
        na_color="white",
        columns="percent"
    )
    .cols_align(align="center", columns=['days','yes','no','percent'])

               )


pretty_days
```
```{python}
month_order = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec']
df['month'] = pd.Categorical(df['month'], categories=month_order, ordered=True)

#what month someone is contacted and success of campaign

month_crosstab = pd.crosstab(df["month"], df["y"])
month_crosstab['percent'] = month_crosstab['yes']/(month_crosstab['yes'] + month_crosstab['no'])
month_crosstab['month'] = month_order
reordered_month = month_crosstab[['month', 'yes', 'no', 'percent']]

pretty_month = (GT(reordered_month)
    .tab_header(title="Month of Contact")
    .fmt_number(columns='percent', decimals=2)
    .data_color(
        palette="Blues",
        domain=[0.11, 1],
        na_color="white"
    )
    .cols_align(align="center", columns=['month','yes','no','percent'])
    .opt_vertical_padding(scale=0.5)
)
pretty_month
```

```{python}
#| label : campaign
#| include : false
#put data into categories
bins = [0,10,20,30,40,50,60,70]
labels=["1-10","11-20","21-30","31-40","41-50","51-60","61-70"]
binned_data = pd.cut(df['campaign'], bins=bins, labels=labels)

#make crosstab table
campaign_crosstab = pd.crosstab(binned_data, df["y"])
campaign_crosstab['percent'] = campaign_crosstab['yes']/(campaign_crosstab['yes'] + campaign_crosstab['no'])
campaign_crosstab.reset_index()
campaign_crosstab['contacts']=campaign_crosstab.index
reordered_campaign = campaign_crosstab[['contacts','yes','no','percent']]
```
```{python}
#stylize table
pretty_campaign = (GT(reordered_campaign)
    .tab_header(title="Number of Contacts")
    .fmt_number(columns='percent', decimals=2)
    .data_color(
        palette="Blues",
        domain=[0.11, 1],
        na_color="white",
        columns="percent"
    )
    .cols_align(align="center", columns=['campaign','yes','no','percent'])
               )

pretty_campaign
```
# Personal & Housing Loans

## Row {height="60px"}
<div style="font-size: 15pt"> To what extent does a client's current loans affect their likelihood of subscribing for the current campaign? </div>

## Row
```{python}
loan_comparison = (
alt.Chart(df_sample)
.transform_fold(
["housing", "loan"],
as_=["Loan Type", "Status"]
)
.mark_bar()
.encode(
x=alt.X("Status:N", title="Has Loan?"),
y=alt.Y("count():Q", title="Number of Clients"),
color=alt.Color("y:N", title="Subscribed?"),
column=alt.Column("Loan Type:N", title=None)
)
.properties(
title="Subscription Status by Housing and Personal Loan Ownership",
width=200,
height=300
)
)

loan_comparison
```

# Past Campaigns
## Row {height="60px"}
<div style="font-size: 15pt"> To what extent does a client's past interaction with the bank affect their likelihood of subscribing for the current campaign? </div>

## Row

```{python}

#Click selection on previous outcome

poutcome_click = alt.selection_point(fields=["poutcome"], value="success")

#Previous outcome selector

poutcome_selector = (
alt.Chart(df_sample)
.mark_bar()
.encode(
y=alt.Y("poutcome:N", sort="-x", title="Previous Campaign Outcome"),
x=alt.X("count():Q", title="Number of Clients"),
color=alt.when(poutcome_click)
.then(alt.Color("poutcome:N"))
.otherwise(alt.value("lightgray")),
opacity=alt.when(poutcome_click)
.then(alt.value(1))
.otherwise(alt.value(0.4)),
)
.add_params(poutcome_click)
.properties(width=250, height=300, title="Select Previous Outcome")
)

#Filtered charts

pdays_filtered = (
alt.Chart(df_sample)
.mark_bar(size=8)
.encode(
x=alt.X("pdays:Q", bin=alt.Bin(maxbins=30), title="Days Since Last Contact"),
y=alt.Y("count():Q", title="Number of Clients"),
color=alt.Color("y:N", title="Subscribed?")
)
.transform_filter(poutcome_click)
.properties(width=300, height=250, title="Days Since Last Contact (Filtered)")
)

previous_filtered = (
alt.Chart(df_sample)
.mark_bar(size=8)
.encode(
x=alt.X("previous:Q", bin=alt.Bin(maxbins=20), title="Number of Previous Contacts"),
y=alt.Y("count():Q", title="Number of Clients"),
color=alt.Color("y:N", title="Subscribed?")
)
.transform_filter(poutcome_click)
.properties(width=300, height=250, title="Previous Contacts (Filtered)")
)


dashboard = poutcome_selector | pdays_filtered | previous_filtered
dashboard.properties(
    title="Interactive Exploration of Past Interactions and Subscription Outcomes"
)

```